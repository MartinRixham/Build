#! /bin/bash

set -Eeuo pipefail

map()
{
	for line in $(cat); do
		echo $line | $@
	done
}

call()
{
	for line in $(cat); do
		$@ $line
	done
}

filter()
{
	for line in $(cat); do
		if echo $line | $@; then
			echo $line
		fi
	done
}

not()
{
	for line in $(cat); do
		if ! echo $line | $@; then
			echo $line
		fi
	done
}

is_installed()
{
	brew ls --versions $(cat) > /dev/null
}

install()
{
	not is_installed | call brew install
}

install_jq()
{
	echo jq | install
	JQ=$(brew --prefix jq)/bin/jq
}

install_dependencies()
{
	$JQ -r .[] | map install
}

build()
{
	$JQ .dependencies | install_dependencies 
}

make_recipe()
{
	install_jq
	cat $1 | build
}

make_recipe recipe.json
